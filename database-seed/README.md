# Database Seed Scripts

This directory contains scripts to populate the database with sample data for testing and development purposes.

## ðŸ“‹ Overview

The seed scripts create:
- **1 Admin User** with full system access
- **8 Sample Employees** from different departments
- **Face Embeddings** for all users (512-dimensional vectors)
- **30 Days of Attendance Records** with realistic patterns
- **Today's Active Attendance** for some employees

## ðŸ—‚ï¸ Available Scripts

### 1. `seedData.js` (Comprehensive)
Full-featured seed script with:
- Complete attendance history (past 30 days)
- Varied check-in/check-out patterns
- Realistic working hours (8-10 hours)
- Weekend exclusion
- Random attendance patterns (70% attendance rate)

**Usage:**
```bash
cd database-seed
npm install
node seedData.js
```

### 2. `seedDataSimple.js` (Fast)
Simplified version with:
- Extended database timeouts for slow connections
- Same user creation with face embeddings
- Lighter attendance data generation
- Better error handling for network issues

**Usage:**
```bash
cd database-seed
npm install
node seedDataSimple.js
```

### 3. `callSeed.js` (Wrapper)
Helper script that calls `seedData.js` with proper error handling.

**Usage:**
```bash
npm run seed
```

## ðŸ‘¥ Created Users

### Admin Account
- **Name:** System Administrator
- **Email:** admin@company.com
- **Password:** admin123
- **Role:** admin
- **Department:** IT
- **Face Registered:** âœ… Yes (30 days ago)

### Employee Accounts

| Name | Email | Password | Department | Role | Face Registered |
|------|-------|----------|------------|------|----------------|
| John Doe | john@company.com | password123 | Engineering | employee | âœ… (25 days ago) |
| Jane Smith | jane@company.com | password123 | HR | employee | âœ… (20 days ago) |
| Mike Johnson | mike@company.com | password123 | Sales | employee | âœ… (18 days ago) |
| Sarah Williams | sarah@company.com | password123 | Marketing | employee | âœ… (15 days ago) |
| Robert Brown | robert@company.com | password123 | Engineering | employee | âœ… (12 days ago) |
| Emily Davis | emily@company.com | password123 | Finance | employee | âœ… (10 days ago) |
| David Wilson | david@company.com | password123 | Operations | employee | âœ… (8 days ago) |
| Lisa Anderson | lisa@company.com | password123 | Customer Support | employee | âœ… (5 days ago) |

## ðŸ” Face Embedding Data

### What are Face Embeddings?

Face embeddings are numerical representations of facial features stored as 512-dimensional vectors. These are generated by deep learning models to uniquely identify individuals.

### Sample vs Production Embeddings

**âš ï¸ IMPORTANT:** The seed scripts generate **sample face embeddings** for testing purposes only.

**Sample Embeddings (Current):**
- Generated mathematically using deterministic algorithms
- Unique for each user based on a seed value
- Consistent across multiple seed runs
- **NOT suitable for production use**
- Cannot match real face images

**Production Embeddings (Real Use):**
- Must be generated from actual face photographs
- Created using the Face Recognition Service (DeepFace)
- Users register faces through the Profile page
- Can successfully match against live camera captures

### How Sample Embeddings Work

```javascript
// Helper function in seed scripts
const generateSampleFaceEmbedding = (seed = 0) => {
  const embedding = [];
  for (let i = 0; i < 512; i++) {
    const value = Math.sin(seed * 1000 + i * 0.1) * 0.5;
    embedding.push(parseFloat(value.toFixed(6)));
  }
  return embedding;
};
```

**Key Points:**
- Each employee gets a unique seed (0-8)
- Produces consistent embeddings for the same seed
- Values range from -0.5 to 0.5
- Simulates the structure of real embeddings

### Registering Real Face Embeddings

To use actual face recognition:

1. **Start all services:**
   ```bash
   # Terminal 1: Backend
   cd backend && npm run dev
   
   # Terminal 2: Frontend
   cd frontend && npm run dev
   
   # Terminal 3: Face Service
   cd face-service && python app.py
   ```

2. **Login to the application:**
   - Go to http://localhost:3000/login
   - Use any seeded account credentials

3. **Register your face:**
   - Navigate to Profile page
   - Click "Register Face" or "Update Face"
   - Allow camera access
   - Capture your face photo
   - System generates real 512-dimensional embedding

4. **Test face recognition:**
   - Go to Dashboard
   - Use "Check-In with Face" button
   - System compares live capture with stored embedding

## ðŸ“Š Attendance Data Patterns

### Historical Records (Past 30 Days)

**Generated Patterns:**
- **Weekdays Only:** No weekend attendance
- **70% Attendance Rate:** Realistic absenteeism
- **Check-in Time:** 8:00 AM - 10:00 AM (random)
- **Check-out Time:** 4:00 PM - 7:00 PM (random)
- **Working Hours:** 6-9 hours typically
- **20% Still Active:** Some records without check-out

### Today's Records

- 4 employees with active check-ins
- 50% have checked out
- Realistic time patterns

## ðŸ”§ Configuration

### Environment Variables

Create a `.env` file in the `backend` directory:

```env
MONGODB_URI=mongodb://localhost:27017/attendance_portal
# Or for MongoDB Atlas:
# MONGODB_URI=mongodb+srv://username:password@cluster.mongodb.net/attendance_portal
```

### Connection Settings

**seedData.js:**
```javascript
{
  serverSelectionTimeoutMS: 30000,  // 30 seconds
  socketTimeoutMS: 45000,           // 45 seconds
  maxPoolSize: 10
}
```

**seedDataSimple.js:**
```javascript
{
  serverSelectionTimeoutMS: 60000,  // 60 seconds
  socketTimeoutMS: 90000,           // 90 seconds
  connectTimeoutMS: 90000,
  maxPoolSize: 10
}
```

## ðŸš€ Running the Seeds

### Prerequisites

1. **MongoDB Running:**
   ```bash
   # Local MongoDB
   mongod
   
   # Or use MongoDB Atlas (cloud)
   ```

2. **Backend .env Configured:**
   ```bash
   cd ../backend
   cp .env.example .env
   # Edit .env with your MongoDB URI
   ```

3. **Dependencies Installed:**
   ```bash
   cd database-seed
   npm install
   ```

### Execution

**Method 1: Direct execution**
```bash
node seedData.js
```

**Method 2: Using npm script**
```bash
npm run seed
```

**Method 3: Using wrapper**
```bash
node callSeed.js
```

### Expected Output

```
Connecting to MongoDB...
âœ“ Connected to MongoDB
Clearing existing data...
âœ“ Cleared existing data
Creating admin user...
âœ“ Admin user created with face embedding
Creating sample employees with face embeddings...
âœ“ Created 8 employees
Creating sample attendance records...
âœ“ Created 168 attendance records
âœ“ Created today's attendance

========================================
âœ“ Database seeded successfully!
========================================

=== Login Credentials ===
Admin: admin@company.com / admin123
Employees: [name]@company.com / password123
Names: John, Jane, Mike, Sarah, Robert, Emily, David, Lisa
========================

=== Face Recognition Data ===
âœ“ All employees have face embeddings registered
âœ“ Face embeddings are 512-dimensional vectors
âœ“ Note: These are sample embeddings for testing
âœ“ In production, use actual face photos for registration
================================

âœ“ Disconnected from MongoDB
```

## âš ï¸ Warnings & Notes

### Data Destruction
**âš ï¸ WARNING:** Seed scripts **DELETE ALL EXISTING DATA** before seeding:
```javascript
await Employee.deleteMany({});
await Attendance.deleteMany({});
```

**Never run in production!**

### Sample Data Limitations

1. **Face Embeddings:**
   - Cannot match real face photos
   - For UI/database testing only
   - Must re-register faces for actual recognition

2. **Attendance Patterns:**
   - Simplified compared to real-world scenarios
   - No leave, holidays, or special cases
   - Random generation, not business logic

3. **User Data:**
   - Generic names and departments
   - Simple password (not production-safe)
   - No additional profile information

## ðŸ”„ Re-seeding

To reset the database and re-seed:

```bash
# Method 1: Run seed script again (auto-clears)
node seedData.js

# Method 2: Manual clear then seed
# First, clear manually:
mongosh attendance_portal --eval "db.dropDatabase()"
# Then seed:
node seedData.js
```

## ðŸ› Troubleshooting

### Connection Issues

**Problem:** `MongoServerError: connect ECONNREFUSED`

**Solution:**
```bash
# Check if MongoDB is running
mongod --version

# Start MongoDB service
# Windows:
net start MongoDB

# macOS/Linux:
sudo systemctl start mongod
```

### Timeout Errors

**Problem:** `MongooseServerSelectionError: connect timed out`

**Solution:**
- Use `seedDataSimple.js` (longer timeouts)
- Check network connection
- Verify MongoDB Atlas IP whitelist
- Increase timeout values

### Duplicate Key Errors

**Problem:** `E11000 duplicate key error`

**Solution:**
```bash
# Drop the database first
mongosh attendance_portal --eval "db.dropDatabase()"
# Then re-seed
node seedData.js
```

## ðŸ“š Additional Resources

- [MongoDB Connection Guide](https://docs.mongodb.com/manual/reference/connection-string/)
- [Mongoose Documentation](https://mongoosejs.com/docs/guide.html)
- [DeepFace Library](https://github.com/serengil/deepface)
- [Face Recognition Theory](https://en.wikipedia.org/wiki/Facial_recognition_system)

## ðŸ‘¨â€ðŸ’» Author

**PRAVAKAR DAS**
- GitHub: [@PravakarDas](https://github.com/PravakarDas)

---

**Last Updated:** December 2025
